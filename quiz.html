<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz de Ausculta Pulmonar</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #eef2f5;
        }
        .container {
            text-align: center;
            padding: 40px;
            border-radius: 15px;
            background-color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 700px;
        }
        #start-container {
            display: block; /* Começa visível */
        }
        #quiz-container {
            display: none; /* Começa escondido */
        }
        h1 {
            color: #333;
            margin-top: 0;
        }
        #audio-player {
            width: 100%;
            margin: 30px 0;
        }
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        .option-btn, .action-btn {
            padding: 18px;
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            border-radius: 10px;
            color: white;
            transition: all 0.2s ease-in-out;
        }
        .option-btn {
            background-color: #f0f0f0;
            color: #333;
            border: 2px solid transparent;
        }
        .option-btn:hover:not(:disabled) {
            border-color: #007bff;
            background-color: #e9f2ff;
        }
        .option-btn:disabled {
            cursor: not-allowed;
        }
        .correct {
            background-color: #28a745 !important;
            color: white !important;
            border-color: #28a745 !important;
        }
        .incorrect {
            background-color: #dc3545 !important;
            color: white !important;
            border-color: #dc3545 !important;
        }
        #feedback {
            margin-top: 25px;
            font-size: 18px;
            font-weight: bold;
            height: 30px;
        }
        #start-btn, #next-btn {
            background-color: #007bff;
        }
        #next-btn {
            display: none;
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="start-container">
            <h1>Quiz de Ausculta Pulmonar</h1>
            <p>Prepare-se para testar seus conhecimentos. Clique abaixo para começar.</p>
            <button id="start-btn" class="action-btn" onclick="startQuiz()">Iniciar Quiz</button>
        </div>

        <div id="quiz-container">
            <h1>Qual ruído pulmonar é este?</h1>
            <p>Ouça o áudio e selecione a categoria correta.</p>
            <audio id="audio-player" controls></audio>
            <div id="options-container" class="options-grid"></div>
            <div id="feedback"></div>
            <button id="next-btn" class="action-btn" onclick="nextQuestion()">Próxima Pergunta</button>
        </div>
    </div>

    <script>
        const startContainer = document.getElementById('start-container');
        const quizContainer = document.getElementById('quiz-container');
        const audioPlayer = document.getElementById('audio-player');
        const optionsContainer = document.getElementById('options-container');
        const feedbackDiv = document.getElementById('feedback');
        const nextBtn = document.getElementById('next-btn');

        const sounds = [
            { file: "som_01.mp3", category: "Ausculta Normal" },
            { file: "som_02.mp3", category: "Respiração Bronquial" },
            { file: "som_03.mp3", category: "Sibilos" },
            { file: "som_04.mp3", category: "Sibilos" },
            { file: "som_05.mp3", category: "Sibilos" },
            { file: "som_06.mp3", category: "Ronco" },
            { file: "som_07.mp3", category: "Crepitantes" },
            { file: "som_08.mp3", category: "Crepitantes" },
            { file: "som_09.mp3", category: "Crepitantes" },
            { file: "som_10.mp3", category: "Atrito Pleural" },
            { file: "som_11.mp3", category: "Estridor" }
        ];

        const uniqueCategories = [...new Set(sounds.map(s => s.category))];
        let currentCorrectCategory = '';
        let availableSounds = [...sounds];

        function startQuiz() {
            startContainer.style.display = 'none';
            quizContainer.style.display = 'block';
            nextQuestion();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function nextQuestion() {
            if (availableSounds.length === 0) {
                availableSounds = [...sounds];
            }
            
            const questionIndex = Math.floor(Math.random() * availableSounds.length);
            const questionSound = availableSounds.splice(questionIndex, 1)[0];
            currentCorrectCategory = questionSound.category;
            
            audioPlayer.src = questionSound.file;
            
            // ===== LINHA ADICIONADA =====
            audioPlayer.load(); // Força o navegador a carregar o novo arquivo de áudio.
            // ============================
            
            const incorrectCategories = uniqueCategories
                .filter(cat => cat !== currentCorrectCategory)
                .sort(() => 0.5 - Math.random())
                .slice(0, 3);
            
            const options = [currentCorrectCategory, ...incorrectCategories];
            shuffleArray(options);
            
            optionsContainer.innerHTML = '';
            options.forEach(category => {
                const button = document.createElement('button');
                button.textContent = category;
                button.classList.add('option-btn');
                button.onclick = () => checkAnswer(button, category);
                optionsContainer.appendChild(button);
            });
            
            feedbackDiv.textContent = '';
            nextBtn.style.display = 'none';
        }

        function checkAnswer(button, selectedCategory) {
            document.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);
            
            if (selectedCategory === currentCorrectCategory) {
                button.classList.add('correct');
                feedbackDiv.textContent = 'Correto!';
                feedbackDiv.style.color = '#28a745';
            } else {
                button.classList.add('incorrect');
                feedbackDiv.textContent = `Incorreto. A resposta é ${currentCorrectCategory}.`;
                feedbackDiv.style.color = '#dc3545';
                
                document.querySelectorAll('.option-btn').forEach(btn => {
                    if (btn.textContent === currentCorrectCategory) {
                        btn.classList.add('correct');
                    }
                });
            }
            
            nextBtn.style.display = 'block';
        }
        
    </script>

</body>
</html>